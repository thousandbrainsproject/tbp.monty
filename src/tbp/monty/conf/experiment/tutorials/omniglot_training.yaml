# @package _global_
# Tutorial: Omniglot character recognition - training
#
# This tutorial demonstrates training on 2D Omniglot characters.
# The agent learns to recognize handwritten characters from different alphabets.
# Inline configs show curvature-focused feature extraction for educational purposes.

defaults:
  - override /mode: pretrain
  - override /logging: pretrain
  - override /agent_config: omniglot
  - override /monty: patch_and_view_learning

_target_: tbp.monty.frameworks.experiments.pretraining_experiments.MontySupervisedObjectPretrainingExperiment
config:
  n_train_epochs: 1
  logging:
    output_dir: ${path.expanduser:${oc.env:MONTY_MODELS}/my_trained_models}
    run_name: omniglot_training
  monty_config:
    # Motor system: 1-degree rotation steps for fine-grained exploration
    motor_system_config:
      motor_system_class: ${monty.class:tbp.monty.frameworks.models.motor_system.MotorSystem}
      motor_system_args:
        policy_class: ${monty.class:tbp.monty.frameworks.models.motor_policies.InformedPolicy}
        policy_args:
          rotation_degrees: 1
          translation_distance: 0.003
          switch_frequency: 1
          action_sampler_class: ${monty.class:tbp.monty.frameworks.actions.action_samplers.ConstantSampler}
    sensor_module_configs:
      sensor_module_0:
        sensor_module_class: ${monty.class:tbp.monty.frameworks.models.sensor_modules.HabitatSM}
        sensor_module_args:
          sensor_module_id: patch
          features:
            - pose_vectors
            - pose_fully_defined
            - on_object
            - principal_curvatures_log
          save_raw_obs: false
          # Need to set this lower since curvature is generally lower
          pc1_is_pc2_threshold: 1
      sensor_module_1:
        sensor_module_class: ${monty.class:tbp.monty.frameworks.models.sensor_modules.Probe}
        sensor_module_args:
          sensor_module_id: view_finder
          save_raw_obs: false
  train_env_interface_class: ${monty.class:tbp.monty.frameworks.environments.embodied_data.OmniglotEnvironmentInterface}
  train_env_interface_args:
    # Train on the first version of each character (there are 20 drawings for each
    # character in each alphabet, here we see one of them). The default
    # OmniglotEnvironmentInterfaceArgs specify alphabets = [0, 0, 0, 1, 1, 1] and
    # characters = [1, 2, 3, 1, 2, 3]) so in the first episode we will see version 1
    # of character 1 in alphabet 0, in the next episode version 1 of character 2 in
    # alphabet 0, and so on.
    alphabets: [0, 0, 0, 1, 1, 1]
    characters: [1, 2, 3, 1, 2, 3]
    versions: [1, 1, 1, 1, 1, 1]
