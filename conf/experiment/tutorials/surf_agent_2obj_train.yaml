# @package _global_
# Tutorial: Surface agent training on 2 objects (mug, banana)
#
# This tutorial demonstrates supervised pretraining with a surface agent.
# Inline configs below are for educational purposes - see how sensor modules,
# learning modules, and connectivity are configured.

defaults:
  - /03_rotation: predefined_14
  - override /mode: pretrain
  - override /logging: pretrain
  - override /agent_config: surface_habitat

_target_: tbp.monty.frameworks.experiments.pretraining_experiments.MontySupervisedObjectPretrainingExperiment
config:
  n_train_epochs: ${vars.rotations_all_count}
  logging:
    output_dir: ${path.expanduser:"~/tbp/results/monty/projects"}
    run_name: surf_agent_1lm_2obj_train
    wandb_handlers: []
  monty_config:
    # Monty class for graph-based learning
    monty_class: ${monty.class:tbp.monty.frameworks.models.graph_matching.model.MontyForGraphMatching}
    monty_args:
      num_exploratory_steps: 500
    # Motor system: curvature-informed surface policy for training
    motor_system_config:
      motor_system_class: ${monty.class:tbp.monty.frameworks.models.motor_system.MotorSystem}
      motor_system_args:
        policy_class: ${monty.class:tbp.monty.frameworks.models.motor_policies.SurfacePolicyCurvatureInformed}
        policy_args:
          action_sampler_class: ${monty.class:tbp.monty.frameworks.actions.action_samplers.ConstantSampler}
    # Connectivity: sensor_module_0 sends to learning_module_0
    sm_to_lm_matrix: [[0]]  # SM0 -> LM0
    lm_to_lm_matrix: [[]]   # No LM-to-LM connections
    # sensory module configs: one surface patch for training (sensor_module_0),
    # and one view-finder for initializing each episode and logging
    # (sensor_module_1).
    sensor_module_configs:
      sensor_module_0:
        sensor_module_class: ${monty.class:tbp.monty.frameworks.models.sensor_modules.HabitatSM}
        sensor_module_args:
          is_surface_sm: true
          sensor_module_id: patch
          # a list of features that the SM will extract and send to the LM
          features:
            - pose_vectors
            - pose_fully_defined
            - on_object
            - object_coverage
            - rgba
            - hsv
            - min_depth
            - mean_depth
            - principal_curvatures
            - principal_curvatures_log
            - gaussian_curvature
            - mean_curvature
            - gaussian_curvature_sc
            - mean_curvature_sc
          save_raw_obs: false
      sensor_module_1:
        sensor_module_class: ${monty.class:tbp.monty.frameworks.models.sensor_modules.Probe}
        sensor_module_args:
          sensor_module_id: view_finder
          save_raw_obs: false
    # learning module config: 1 graph learning module.
    learning_module_configs:
      learning_module_0:
        learning_module_class: ${monty.class:tbp.monty.frameworks.models.graph_matching.GraphLM}
        learning_module_args: {} # Use default LM args
  train_env_interface_class: ${monty.class:tbp.monty.frameworks.environments.embodied_data.InformedEnvironmentInterface}
  train_env_interface_args:
    object_names:
      - mug
      - banana
    object_init_sampler:
      _target_: tbp.monty.frameworks.environments.object_init_samplers.Predefined
      rotations: ${vars.rotations_all}
